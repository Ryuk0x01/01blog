<div class="home-container">

  <!-- Header -->
  <div class="home-header">
    <h1>üè† Home</h1>
    <button mat-stroked-button color="primary" (click)="showCreatePost.set(!showCreatePost())">
      Create Post
    </button>
    <button mat-stroked-button color="primary" (click)="logout()"> Log out </button>
  </div>

  <!-- Error message -->
  @if (errorMessage()) {
  <div class="error-alert">
    {{ errorMessage() }}
  </div>
  }

  @if (loadingPosts()) {
  <div class="loading-container">
    <mat-spinner diameter="40"></mat-spinner>
    <p>Loading posts...</p>
  </div>
  }

  @if (showCreatePost()) {
  <app-create-post></app-create-post>
  }

  <!-- Posts Feed -->
  <div class="posts-feed">
    @if (!posts().length && !loadingPosts()) {
    <div class="no-posts">
      No posts available
    </div>
    }

    @for (p of posts(); track p.id) {
    <mat-card class="post-card">
      <mat-card-header class="post-header">
        <mat-card-title class="post-title">{{ p.title }}</mat-card-title>
        <mat-card-subtitle class="post-meta">
          {{ p.authorUsername }} ¬∑ {{ p.createdAt | date:'short' }}
        </mat-card-subtitle>
      </mat-card-header>

      <mat-card-content>
        @if (p.mediaUrl) {
        <div class="post-media-wrapper">
          @if (p.mediaUrl.includes('.mp4') || p.mediaUrl.includes('.webm') || p.mediaUrl.includes('.ogg')) {
          <video controls class="post-media video">
            <source src="http://localhost:8080{{ p.mediaUrl }}">
            Your browser does not support the video tag.
          </video>
          }

          @if (!(p.mediaUrl.includes('.mp4') || p.mediaUrl.includes('.webm') || p.mediaUrl.includes('.ogg'))) {
          <img class="post-media img" src="http://localhost:8080{{ p.mediaUrl }}" alt="Post image">
          }
        </div>
        }

        <p class="post-content">
          {{ p.content }}
        </p>
      </mat-card-content>

      <mat-card-actions>
        <button mat-button [color]="postLikes()[p.id] ? 'accent' : 'primary'" (click)="likePost(p.id)">
          <mat-icon>{{ postLikes()[p.id] ? 'thumb_up' : 'thumb_up_off_alt' }}</mat-icon>
          Like
        </button>

        <button mat-button color="primary" (click)="toggleComment(p.id)">
          <mat-icon>comment</mat-icon>
          Comment ({{ postCommentCounts()[p.id] || 0 }})
        </button>
      </mat-card-actions>
    </mat-card>
    }
  </div>
</div>