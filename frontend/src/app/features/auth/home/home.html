<div class="container-fluid py-4">

  <!-- Header -->
  <div class="d-flex justify-content-between align-items-center mb-4">
    <h2 class="fw-bold">ğŸ  Home</h2>
    <button class="btn btn-outline-danger" (click)="logout()">Logout</button>
  </div>

  <!-- Error message -->
  @if (errorMessage()) {
  <div class="alert alert-danger">
    {{ errorMessage() }}
  </div>
  }

  @if (loadingPosts()) {
  <div class="text-muted mb-3">
    Loading posts...
  </div>
  }

  <!-- Create Post Form -->
  <div class="card mb-4 shadow-sm">
    <div class="card-body">
      <h5 class="card-title">Create New Post</h5>
      <form (ngSubmit)="createPost()" class="d-flex flex-column gap-2">
        <input type="text" class="form-control" placeholder="Post title..." [(ngModel)]="newPostTitle" name="title"
          [disabled]="creatingPost()">
        <textarea class="form-control" rows="3" placeholder="What's on your mind?" [(ngModel)]="newPostContent"
          name="content" [disabled]="creatingPost()"></textarea>

        <!-- File Input -->
        <div class="input-group">
          <input type="file" class="form-control" id="fileInput" (change)="onFileSelected($event)"
            accept="image/*,video/*" [disabled]="creatingPost()">
          <label class="input-group-text" for="fileInput">ğŸ“ Choose Image/Video</label>
        </div>

        <!-- Selected File Display -->
        @if (selectedFile()) {
        <div class="alert alert-info d-flex justify-content-between align-items-center">
          <span>ğŸ“ {{ selectedFile()!.name }} ({{ (selectedFile()!.size / 1024 / 1024).toFixed(2) }}MB)</span>
          <button type="button" class="btn btn-sm btn-outline-danger" (click)="selectedFile.set(null)">
            Remove
          </button>
        </div>
        }

        <button type="submit" class="btn btn-primary align-self-start" [disabled]="creatingPost()">
          {{ creatingPost() ? 'Publishing...' : 'Publish' }}
        </button>
      </form>
    </div>
  </div>

  <div class="row">
    <!-- Posts -->
    <main class="col-12">
      @if (!posts().length && !loadingPosts()) {
      <div class="text-muted text-center">
        No posts available
      </div>
      }

      @for (p of posts(); track p.id) {
      <div class="card mb-3 shadow-sm">
        <div class="card-body">
          <h5 class="card-title">{{ p.title }}</h5>

          <h6 class="card-subtitle mb-2 text-muted">
            {{ p.authorUsername }} Â· {{ p.createdAt | date:'short' }}
          </h6>

          <p class="card-text">
            {{ p.content }}
          </p>


          <div class="d-flex gap-2">
            <button class="btn btn-sm" [class.btn-primary]="postLikes()[p.id]"
              [class.btn-outline-primary]="!postLikes()[p.id]" (click)="likePost(p.id)">
              ğŸ‘ Like
            </button>

            <button class="btn btn-sm btn-outline-secondary" (click)="toggleComment(p.id)">
              ğŸ’¬ Comment ({{ postCommentCounts()[p.id] || 0 }})
            </button>
          </div>
        </div>
      </div>
      }
    </main>
  </div>
</div>